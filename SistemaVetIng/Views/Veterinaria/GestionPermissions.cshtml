@using SistemaVetIng.ViewsModels
@model ManagePermissionsPageViewModel

@{
    ViewData["Title"] = "Gestión de Permisos";
    Layout = null;

    string controllerDestino = User.IsInRole("Veterinario") ? "Veterinario" : "Veterinaria";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - VetIng</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
          xintegrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="~/css/veterinario-home.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/administracion-home.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/veterinary-dashboard.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/permisos.css" asp-append-version="true" />

</head>
<body class="dark-mode">

    <header class="main-header">
        <a href="/@controllerDestino/PaginaPrincipal" class="logo"><i class="fa-solid fa-paw"></i> VetIng</a>
        <nav class="main-nav">
            <ul class="nav-list">
                <li><a class="nav-link" href="/@controllerDestino/PaginaPrincipal">Volver al Inicio</a></li>
                <li>
                    <form asp-controller="Account" asp-action="Logout" method="post" id="logoutForm">
                        <button type="submit" class="btnlogout btn-primary nav-button">Cerrar Sesión</button>
                    </form>
                </li>
            </ul>
        </nav>
        <div class="hamburger-menu">
            <i class="fa-solid fa-bars"></i>
        </div>
    </header>

    <main class="v1-main-dashboard">
        <section id="gestion-permisos" class="v1-section">
            <h1 class="v1-section-title"><i class="fa-solid fa-shield-halved"></i> @ViewData["Title"]</h1>
            <p style="color: var(--history-text-secondary); margin-top: -0.5rem; margin-bottom: 1.5rem;">
                Selecciona un rol para ver y modificar sus permisos.
            </p>


            <form asp-action="GestionPermissions" method="get" class="v1-filter-bar">

                <div class="v1-select-container">
                    <label for="roleSelect" class="v1-filter-label">Seleccionar Rol:</label>

                    <select asp-for="SelectedRoleId" asp-items="Model.RolesList" class="v1-select" id="roleSelect" onchange="this.form.submit();">
                        <option value="">-- Selecciona un rol --</option>
                    </select>
                </div>


            </form>

            <hr style="border-color: var(--history-border); margin: 2rem 0;" />


            @if (Model.PermissionsForm != null && Model.PermissionsForm.Permissions.Any())
            {
                <div class="v1-card">
                    <div class="v1-card-header">
                        <h3 class="v1-card-title">Permisos para el Rol: <span style="color: var(--v1-color-accent)">@Model.PermissionsForm.RoleName</span></h3>
                    </div>
                    <form asp-action="GestionPermissions" method="post">
                        @Html.AntiForgeryToken()

                        <input type="hidden" asp-for="PermissionsForm.RoleId" />
                        <input type="hidden" asp-for="PermissionsForm.RoleName" />

                        <div class="v1-card-content">
                            <div class="table-container">
                                <table class="table responsive-table">
                                    <thead>
                                        <tr>
                                            <th>Permiso (Módulo - Acción)</th>
                                            <th style="width: 120px; text-align: center;">Permitido</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @for (int i = 0; i < Model.PermissionsForm.Permissions.Count; i++)
                                        {
                                            <tr>
                                                <td data-label="Permiso:">
                                               
                                                    <input type="hidden" asp-for="PermissionsForm.Permissions[i].Type" />
                                                    <input type="hidden" asp-for="PermissionsForm.Permissions[i].Value" />
                                                    <input type="hidden" asp-for="PermissionsForm.Permissions[i].DisplayName" />

                                                    <label for="perm-@i" style="font-weight: 500; cursor: pointer;">
                                                        @Model.PermissionsForm.Permissions[i].DisplayName
                                                    </label>
                                                </td>
                                                <td data-label="Permitido:" style="text-align: center;">
                                                    <label class="v1-toggle-switch">
                                                        <input type="checkbox" asp-for="PermissionsForm.Permissions[i].IsSelected" id="perm-@i" />
                                                        <span class="slider round"></span>
                                                    </label>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="v1-card-footer v1-form-actions">
                            <button type="submit" class="v1-btn v1-btn-primary">
                                <i class="fa-solid fa-save"></i> Guardar Cambios
                            </button>
                        </div>
    
                    </form>
                  
                </div>
               
            }
            else if (!string.IsNullOrEmpty(Model.SelectedRoleId))
            {
                <div class="v1-alert v1-alert-warning">No se pudieron cargar los permisos para este rol.</div>
            }
        </section>
    </main>

    <footer class="main-footer">
        <div class="footer-bottom">
            <p>&copy; @DateTime.Now.Year VetIng Software. Todos los derechos reservados. | Proyecto de Ulises Sosa y Leonel Gallaretto</p>
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/js/menuhamburguesa.js" asp-append-version="true"></script>
    @await Component.InvokeAsync("NToastNotify")
</body>
</html>