@model HistorialPagosViewModel
@using SistemaVetIng.ViewsModels
@using X.PagedList.Mvc.Core;
@using X.PagedList;
@using System.Globalization;

@{
    ViewData["Title"] = "Historial de Pagos";
    Layout = null; 
    string controllerDestino = "Cliente";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/veterinario-home.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/administracion-home.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/veterinary-dashboard.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    
</head>
<body class="dark-mode"> 
    <header class="main-header">
        <a href="#" class="logo">
            <i class="fas fa-paw"></i>
            <span>VetIng</span>
        </a>
        <a asp-controller="@controllerDestino" asp-action="PaginaPrincipal" class="sesion">
            <i class="fas fa-arrow-left"></i> Volver al Inicio
        </a>
    </header>

    <main class="v1-main-dashboard">
        <section class="v1-section">
            <h1 class="v1-section-title">Mi Historial de Pagos</h1>
            
            <div class="v1-card">
                <div class="v1-card-header">
                    <h3 class="v1-card-title">Pagos Realizados</h3>
                </div>
                    @if (Model.PagosPaginados != null && Model.PagosPaginados.Any())
                    {
                    <div class="v1-card-content">
                        <div class="table-container">
                            <table class="table responsive-table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Método de Pago</th>
                                        <th class="text-right">Monto</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var pago in Model.PagosPaginados)
                                    {
                                        <tr>
                                            <td data-label="Fecha:">@pago.Fecha.ToString("dd/MM/yyyy HH:mm") hs</td>
                                            <td data-label="Método:">
                                                <i class="@pago.IconoCssClass table-icon"></i>
                                                @pago.MetodoDePago
                                            </td>
                                            <td data-label="Monto:" class="text-right">
                                                <strong>@pago.Monto.ToString("C", new CultureInfo("es-AR"))</strong>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div> 

                    <div class="v1-card-footer pagination-container">
                        @if (Model.PagosPaginados.PageCount > 1)
                        {
                            @Html.PagedListPager(Model.PagosPaginados, page => Url.Action("HistorialPagos",
                                new { page }), 
                                new PagedListRenderOptions
                                {
                                    LiElementClasses = new string[] { "page-item" },
                                    PageClasses = new string[] { "page-link" },
                                    DisplayLinkToFirstPage = PagedListDisplayMode.IfNeeded,
                                    DisplayLinkToLastPage = PagedListDisplayMode.IfNeeded,
                                    DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                                    DisplayLinkToNextPage = PagedListDisplayMode.Always,
                                    ContainerDivClasses = new[] { "pagination justify-content-center" }
                                })
                        }
                        else
                        {
                            <p class="text-muted text-center" style="margin:0;">
                                Mostrando @Model.PagosPaginados.TotalItemCount @(Model.PagosPaginados.TotalItemCount == 1 ? "pago" : "pagos")
                            </p>
                        }
                    </div>
                }
                else
                {
                    <div class="v1-empty-state" style="padding: 2rem;">
                         <i class="fas fa-file-invoice-dollar fa-3x" style="color: var(--history-border, #444); margin-bottom: 1rem;"></i>
                        <p>No tienes pagos registrados.</p>
                    </div>
                }
            </div> 
        </section>
    </main>

    <footer class="main-footer">
         <div class="footer-bottom">
             <p>&copy; @DateTime.Now.Year VetIng Software. Todos los derechos reservados. | Proyecto de Ulises Sosa y Leonel Gallaretto</p>
         </div>
     </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    @await Component.InvokeAsync("NToastNotify")
</body>
</html>